# Глава 4. Токены

После того, как мы поговорили об аккаунтах вполне логично поговорить про другую важную сущность в блокчейне Waves - про токены. Мне лично кажется необходимым начать с истории вопроса, потому что многие все еще знают Waves как платформу для выпуска токенов. В эру бума ICO (2017 год) Waves был второй по популярности платформой для выпуска токенов, потому что позволяла сделать это очень просто. На первом месте был Ethereum, в котором для выпуска токенов необходимо писать смарт-контракт (очень простой и чаще всего в соответствии с ERC-20, но все же). В Waves же выпуск токена делается крайне просто - отправкой одной транзакции специального типа `Issue`.

<!-- TODO: добавить картинку с количеством токенов на Waves/Eth -->

В некоторых клиентах для Waves (например, в Waves.Exchange) достаточно заполнить одну небольшую форму для выпуска простого токена, который автоматически будет доступен для переводов между аккаунтами, работы с децентрализованными приложениями или торговли на DEX. В данный момент в блокчейне Waves выпущено более 20 000 различных видов токенов.

## Принципы работы токенов

В Waves все токены являются "граждами первого сорта" (first-class citizens), они есть прямо в ядре блокчейна, как есть, например, аккаунты. Некоторые (особенно с опытом работы с Ethereum) удивляются этому, но такой подход имеет ряд преимуществ:

- **Простота выпуска.** В 2017 году Waves занимал второе место именно благодаря простоте выпуска, что не надо было разбираться как работает Solidity или EVM, чтобы сделать токен, привязать к каким-то активам в реальной жизни, и начать использовать.
- **Быстрота работы.** Простые токены в Waves не исполняют никакого кода смарт-контрактов для своей работы, поэтому будут работать быстрее, чем в случае с Solidity. Фактически простой токен в Waves - запись в базе данных LevelDB.
- **Возможность торговли из коробки.** Выпускаемые токены на Waves автоматически поддерживаются для торговли на децентрализованных биржах на базе матчера Waves. Про работу матчера мы поговорим отдельно.

*У вас уже должен был возникнуть вопрос, а что если я хочу не просто выпустить токен, но сделать для него свою логику?*

**Такое тоже возможно с помощью создания смарт-ассетов, которые мы рассмотрим позже в этой главе.**

Много новых разработчиков спрашивают, чем отличается **ассет** от **токена**. В коде ноды Waves вы гораздо чаще будете встречать слоово `asset`, нежели `token`, но для удобства в рамках этой книги предлагаю считать эти 2 понятия взаимозаменяемыми. Да, в реальной жизни `asset` это скорее актив, а `токен` скорее что-то близкое к жетону, но в мире блокчейна граница между понятиями размылась.

В Waves есть только один токен, который не является ассетом - это сам токен Waves, который платится как комиссия майнерам. Можно сказать, что все токены в Waves равны по возможностям, но токен Waves чуть "ровнее" и его поведение отличается от других ассетов.

## Выпуск токена

Как я уже писал выше, для выпуска токена достаточно отправить транзакцию типа `Issue`, что можно легко сделать с помощью библиотеки на JS:

```js

const { issue } = require('@waves/waves-transactions')

const seed = 'seed phrase of fifteen words'

const params = {
  name: 'Euro',
  description: 'It is an example of token',
  quantity: 1000000,
  //senderPublicKey: 'by default derived from seed',
  reissuable: false,
  decimals: 2,
  script: null,
  timestamp: Date.now(),
  fee: 100000000,
}

const signedIssueTx = issue(params, seed)
console.log(signedIssueTx)

```

В результате выполнения этого кода в консоль выведется следующий JSON:

```json
{
  "id": "CZw4KCpPUv5t1Uym3rLc9yEaQyDsP3VVPspdpmWKvVPE",
  "type": 3,
  "version": 2,
  "senderPublicKey": "HRQUmzJKgHDGbsfS23kSA1VRuudy5MY3wGCroUmNhKuJ",
  "name": "Euro",
  "description": "It is an example of token",
  "quantity": 1000000,
  "decimals": 2,
  "reissuable": false,
  "script": null,
  "fee": 100000000,
  "timestamp": 1575034734086,
  "chainId": 87,
  "proofs": [
    "2ELbuezHiaHUDCuWpfhULwqSA8SUm4vGzWQe5QUmLEPZTA5WMXctiaXaoF9aUbr8TBSBreQxa8WYMsp6Sy2qSSGU"
  ]
}
```

Давайте разберем основные параметры:

- **name** - название токена (4-16 байт)
- **description** - описание для токена (0-1000 байт)
- **quantity** - количество выпускаемых токенов
- **decimals** - количество знаков после запятой. Обратите внимание, что если поставить значение равное `0`, то токен будет неделимый. В примере выше минимальной единицой будет не 1 токен, а одна стоая от токена, что логично, так как мы выпускаем аналог евро как пример. Если быть точнее, то выпускаем 1 миллион токенов под название `Euro`, минимальной единицей которой будет евроцент.
- **reissuable** - флаг перевыпускаемости токена. Если значение равно `true`, то владелец токена в любой момент может довыпустить сколько угодно новых токенов такого вида. В момент перевыпуска, владелец может поменять значение этого флага, таким образом зафиксировав количество токенов в блокчейне.
- **script** - скомпилированный Ride скрипт, описывающий логику работы токена. В нашем примере значаение равно `null`, так как мы не хотим задавать никаких правил обращения токена.
- **fee** - комиссия за выпуск токена. В Waves минимальный транзакция для выпуска обычного токена (не NFT) составляет 1 Waves. Почему же тогда в транзакции указано 100000000, где аж 8 нолей? Все просто, у токена Waves количество decimals равно 8, а комиссия указывается в самых маленьких единицах, в случае с Waves минимальные единицы называют иногда ***waveslet***.


Отправив такую подписанную транзакцию, можно создать новый токен с названием `Euro`. Конечно, никакой ценности в таком токене нет, но ценность это уже следующий вопрос. Новосозданный токен получит уникальный идентификатор `assetId` равный ID транзакциии, которая его породила, в нашем случае `CZw4KCpPUv5t1Uym3rLc9yEaQyDsP3VVPspdpmWKvVPE`.

Данное правило может быть крайне полезным, поэтому предлагаю запомнить - `assetId` токена равен `ID` issue транзакции, которая его создала. В дальнейшем при работе с этим токеном придется использовать  именно его assetId в подавляющем боольшинстве случаев.

Другой важный параметр, который надо запомнить, у токена Waves (нативного/системного для оплаты транзакций) нет `assetId`, поэтому в местах, где для других токенов вставляется длинная строка, для Waves необходимоо ставить `null`.

## Выпуск NFT токена

Non-fungible токены очень часто используются для различных механик, чаще всего игровых. NFT отличаются тем, что каждый токен уникален и имеет свой уникальный идентификатор. В Waves выпуск Non-fungible токена осуществляется так же, как и выпуск fungile токенов, за несколькими ограничениями:

- `quantity` обязательно должно быть равно единице
- `decimals` всегда должно быть 0
- `reissuable` должно быть задано `false`

При соблюдении условий выше уже можно выпускать токен с комиссией не в 1 Waves, а в тысячу раз меньше - 0.001 Waves. Для удобной работы с NFT токенами существует JavaScript библиотека `@waves/waves-games`, которая упрощает создание и сохранение мета-информации о токене. Пример выпуска NFT с помощью этой библиотеки найдете ниже:

```js

import { wavesItemsApi } from '@waves/waves-games'
const seed = 'my secret backend seed'

const items = wavesItemsApi('T') //testnet, use 'W' for mainnet
const item = await items
  .createItem({
    version: 1,
    quantity: 100,
    name: 'The sword of pain',
    imageUrl: 'https://i.pinimg.com/originals/02/c0/46/02c046b9ec76ebb3061515df8cb9f118.jpg',
    misc: {
      damage: 22,
      power: 13,
    },
  }).broadcast(seed)
console.log(item)

```

Обратите внимание, что в примере выше выпускается 100 токенов, не токен с количеством 100, а 100 разных, у каждого из которых будет уникальный ID. Другими словами, библиотека отправит 100 issue транзакций. Минимальная комиссия за каждый токен составит 0.001 Waves, а для всех 100 - 0.1 Waves. Больше примеров по работе с библиотекой для NFT вы найдете в [их туториалах](https://docs.item.market/sdk/lib.html#installation).

## Перевыпуск токенов

Если у токена в момент создания стояло значение `true` для поля `reissuable`, то создатель может отправлять транзакции типа `Reissue`, который позволит довыпустить еще токенов. Пример генерации reissue транзакции во многом похож на пример с issue:

```js

const { reissue } = require('@waves/waves-transactions')

const seed = 'example seed phrase'

const params = {
  quantity: 1000000,
  assetId: 'CZw4KCpPUv5t1Uym3rLc9yEaQyDsP3VVPspdpmWKvVPE',
  reissuable: false
}

const signedReissueTx = reissue(params, seed)

```

Главное отличие в том, что название или описание мы поменять не можем. В нашем примере мы довыпускаем к уже выпущенному миллиону токенов с названием Euro, еще один миллион.

Вы так же можете заметить, что в этой транзакции тоже есть флаг `reissuable`. Если отправить reissue транзакцию с полем `reissuable` равным `true`, то в дальнейшем отправлять такие транзакции для этого токена уже будет нельзя.

В примере выше поле комиссия опущена, но библиотека `@waves/waves-transactions` автоматически подставит минимальное значение в 1 Waves. Я часто пишу "минимальное значание" комиссии, чтобы показать, что это значение можно сделать больше, но сейчас сеть Waves не испытывает проблем с пропускной способностью, поэтому даже транзакции с минимальной комиссией почи моментально попадают в блоки.

Обратите внимание, что в истории Waves недолгое время был баг, который позволял перевыпускать токены, у которых `reissuable` был равен `false`. Баг был оперативно поправлен, но в блокчейне могут встратиться некоторые токены, которые всегда были неперевыпускаемые, но были перевыпущены. Удалить их оттуда не получится, ведь блокчейн иммутабелен. Так что об этом только стоит знать, если вы вдруг делаете эксплорер или какую-то аналитику.

## Сжигание токенов

Иногда бывает, что токен мешает и не хочется видеть его в портфолио, а очень часто встречается необходимость сжигать по какой-то бизнес логике. Для этого в Waves есть транзакция типа `Burn`, которая позволяет сжечь токены (но только со своего аккаунта, конечно).

```js

const { burn } = require('@waves/waves-transactions')

const seed = 'example seed phrase'

const params = {
  assetId: 'CZw4KCpPUv5t1Uym3rLc9yEaQyDsP3VVPspdpmWKvVPE',
  quantity: 100
}

const signedBurnTx = burn(params, seed)

```

Транзакция burn максимально прооста и позволяет задать assetId токена, который хотим сжечь и количество. Собственно, все.

## Изменение информации о токене

Очень много пользователей спрашивают, можно ли поменять название или описание своего токена. Причин для этого может быть много - переименование компании, изменение адреса веб-сайта (адрес сайта мог быть в описании токена). До недавнего времени такое изменение было невозможно и заданное в самом начале жизни название и описание были навсегда с токеном, но в начале 2020 года появилась транзакция `UpdateAssetInfo`, которая позволяет обновить название и описание, но не чаще, чем раз в 100 000 блоков, что примерно равно 2,5 месяцев. На момент написания этих строк функционал был активирован только в stagenet и транзакция `UpdateAssetInfo` еще не поддерживалась библиотеками.

## А дальше что?

Выпуск токена в большинстве случаев является только началом интеграции, поэтому в дальнейшем мы поговорим о том, как использовать Ride для задания логики и API для интеграций вашей бизнес логики с блокчейном.
