# Глава 8. Лучшие друзья разработчика

Как говорит моя девушка, у разработчиков нет друзей, но мы то знаем, что это не так, потому что лучшие друзья разработчика - инструменты для разработки.

В ходе разработки Web3 приложений необходимо постоянно взаимодействовать с нодами блокчейна, как для получения информации, так и для отправки данных в виде транзакции. С другой стороны, создание Web3 приложений подразумевает взаимодействие с пользователем, в том числе запросы подписей транзакций для совершения действий или проверки состояния аккаунтов и т.д.

В экосистеме Waves существует несколько ресурсов и инструментов, которые могут быть полезны для этих целей, давайте рассмотрим их.

## Node REST API

Как вы возможно помните из главы 2 про конфигурирование ноды (на самом деле наверняка забыли за эти 100 с лишним страниц), нода Waves имеет встроенный REST API для получения и отправки данных. Многие другие блокчейны используют JSON RPC, а не REST, но именно наличие REST позволяет максимально упростить общение с нодой. По умолчанию REST API ноды выключен в конфигурации, но есть публичные ноды, которые позволяют делать запросы на получение данных и отправку транзаций:

- `nodes.wavesplatform.com` для mainnet
- `nodes-testnet.wavesplatform.com` для testnet
- `nodes-stagenet.wavesplatform.com` для stagenet

REST API ноды разделен на 2 большие части - публичную часть, которая доступна без ключа, и приватную, которая доступна только при передаче API Key. API Key публичных нод Waves получить нельзя (в подавляющем большинстве случаев это и не требуется), но если вам все-таки нужны методы, требующие ключа, то вам необходимо развернуть свою ноду.

> Обратите внимание, что в конфигурационном файле указывается хэш API Key (как правильно получить хэш описано [в документации](https://docs.wavesprotocol.org/en/waves-node/node-configuration#how-to-generate-hash-of-the-api-key)), а при вызове методов передается сам API Key в открытом виде.

Во многих библиотеках для Waves на разных языках программирования (о них мы поговорим ниже), есть поддержка методов общения с API ноды. Все из них поддерживают метод `broadcast`, который отправляет подписанную транзакцию в сеть через REST API. Но некоторые библиотеки имеют и другие полезные функции, например, в `waves-transactions` есть функции для запроса состояния хранилища любого аккаунта целиком или конкретного ключа (`accountData` и `accountDataByKey`), функция для запроса баланса или информации о скрипте конкретного аккаунта по его адресу (`balance`, `assetBalance` и `scriptInfo`), функции ожидания какой-то высоты блокчейна и ожидания попадания транзакции в блок (`waitForHeight`, `waitForTx`, `waitForTxWithNConfirmations`) и т.д.

REST API ноды достаточно сильно ограничен в плане фильтров и поиска транзакций по полям, но для такого рода операций лучше использовать дата-сервисы.

## Data service API

Дата-сервисы доступны по адресу `https://api.wavesplatform.com/v0/docs/` для использования в mainnet или `https://api-test.wavesplatform.com/v0/docs/` для testnet, но также вы можете использовать и на своих серверах, развернув из репозитория проекта на Github - `https://github.com/wavesplatform/data-service`.

Дата сервисы постоянно выкачивают информацию о транзакциях и блоках в блокчейне и сохраняют в реляционную базу данных (Postgresql), чтобы обеспечивать б**о**льшую гибкость поиска (благодаря индексированию). Если вы все-таки захотите использовать дата-сервисы на своих серверах, учтите, что реляционная база данных с блокчейном Waves занимает более 250 гигабайт.

Дата сервисы так же могут сохранять информацию по торгам на DEX, например, информацию об истории операций в различных парах, биржевые свечи и т.д.

## Библиотеки для языков программирования

В рамках этой книги все примеры были с использованием JavaScript и библиотек `waves-transactions` и `waves-crypto`, но кроме них существуют библиотеки и для других языков программирования:

- JavaScript/TypeScript - [waves-transactions](https://github.com/wavesplatform/waves-transactions)
- Python - [PyWaves](https://github.com/PyWaves/PyWaves/)
- PHP - [WavesKit](https://github.com/deemru/WavesKit)
- C# - [WavesCS](https://github.com/wavesplatform/WavesCS)
- Go - [GoWaves](https://github.com/wavesplatform/gowaves)
- Java - [WavesJ](https://github.com/wavesplatform/WavesJ)
- Kotlin - [WavesSDK](https://github.com/wavesplatform/WavesSDK-android)
- Swift - [WavesSDK](https://github.com/wavesplatform/WavesSDK-iOS)

Библиотеки поддерживают последние обновления протокола и имеют во многом похожие примитивы. Относительно сильно отличается только библиотека `PyWaves`.

Кроме перечисленных выше, существуют библиотеки для C, Rust и Elixir, однако они не поддерживают подписание всех типов транзакций (или их последних версий) и активно ищут мейнтейнеров.

## Расширения к ноде - gRPC и Matcher

Версия ноды Waves на Scala (напомню, что есть так же версия на Go) позволяет расширять свой функционал. Расширения имеют возможность подписываться на различные события в блокчейне и реализовывать любой функционал на базе этого. Например, [Matcher](https://github.com/wavesplatform/dex), который является сердцем децентрализованной биржи, использует функционал расширения для общения с нодой и получения актуального состояния балансов и блокчейна. Другой пример расширения - [gRPC сервер](https://docs.wavesprotocol.org/en/waves-node/extensions/grpc-server/), который позволяет общаться с нодой не по текстовому REST, а по бинарному [gRPC](https://en.wikipedia.org/wiki/GRPC), что в некоторых случаях может быть в разы быстрее.

Еще один пример расширения для ноды - [Waves Node Tools Extension](https://github.com/msmolyakov/waves-node-tools-extension) за авторством Максима Смолякова, которое автоматизирует выплаты вознаграждения лизерам ноды. Если у вас есть лизинговый пул и люди отправляют токены к вам в лизинг в расчете на получения доли с зарабатываемого нодой, то вы можете использовать это расширение. Расширение фиксирует приходы лизингов, моменты майнинга блоков данной нодой и вклад каждого лизера в генерирующий баланс на момент создания блока. В дальнейшем скрипт распределяет заработанные токены лизерам, удерживая комиссию владельца ноды. Расширение даже может уведомлять владельца ноды о таких событиях как сгенерированный блок или момент выплат с помощью вызова веб-хук.

Установка расширения для ноды обычно состоит из 2 шагов:

- установка `.deb` пакета или скачивание `.jar` файла с логикой расширения
- обновления конфигурации ноды с указанием названия пакета расширения

В конфигурационном файле ноды также могут задаваться параметры расширения. Например, установка расширения Waves Node Tools Extension подразумевает установку `.deb` пакета и добавление в конфигурационный файл следующих строк:

```hocon
# добавление расширения в список расширений ноды
waves.extensions += "im.mak.nodetools.NodeToolsExtension"

# настройки расширения Waves Node Tools Extension
node-tools {
  webhook {
    url = "SPECIFY YOUR ENDPOINT" # example: "https://example.com/webhook/1234567890"
    method = "POST"
    headers = [] # example: [ "Content-Type: application/json; charset=utf-8", "Authorization: Basic dXNlcjpwYXNzd29yZA==" ]
    body = "%s" # example for Integram: """{"text":"%s"}"""
  }
}
```
